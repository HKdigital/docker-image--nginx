
## About

The image generated by this project can be used as to run an NGINX server. The docker image contains default configurations for different setups: `ingress proxy`, `secure-ingress-proxy`, `secure-webserver` and `webserver`.

# Usage

## Just try it out

In the `/examples` folder, you'll find `docker-files` for the different setups.

Note that you should change the image (local) `hkdigital-nginx-2021a` to `hkdigital/nginx-2021a` if you use the image from docker hub.

## Build locally

Clone the latest commit from github into a local working directory

```bash
git clone --depth 1 \
  git@github.com:hkdigital/docker-images-nginx-2021a.git \
  hkdigital-nginx-2021a
```

Build the docker image

```bash
./build-latest-image.sh
```

## Use cases (docker-compose)

### Run using docker-compose

Below an example of using the image in a docker-compose file. More examples can be found in the `/examples` folder.

```yaml
version: "3"

services:
  website:
    image: hkdigital-nginx-2021a     # local
    # image: hkdigital/nginx-2021a   # docker-hub
    
    restart: on-failure # "no"|always|on-failure|unless-stopped

    ports:
      # Let docker choose port numbers on the host
      # - "80"

      # host-port -> container port
      - "10080:80"

    volumes:
      - website:/mnt

volumes:
  website:
```

### Run bash in a running container

Run the following command to run [bash] inside the container

```
docker-compose exec webserver bash
```

### Check NGINX config and reload NGINX when ok

Using the container script

```
docker-compose exec website /srv/check-nginx-config-and-reload.sh
```

### Manually check NGINX config in a running container

```bash
docker-compose exec website nginx -t -c /@config/nginx.conf
```

### Manually reload NGINX in a running container

```bash
docker-compose exec website nginx -s reload
```
